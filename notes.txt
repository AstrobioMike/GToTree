## next: 
    # can/should i make a class for the ncbi accs like i have for the genome files (or use the same one)...
    # work on grabbing all remaining genomes (AA files) and associating them with IDs
        # maybe a new class to hold these (or just a dict)
        # but if i make a class, i can add all the info i want to put in the final summary table
        # may need to fix naming of final AA files by stripping prefixes (or doing that earlier)
    # hmm search
    # filtering hits
    # filtering genomes
    # alignments
    # concatenation and renaming
    # treeing
    # optional ko search
    # optional pfam search
    # move snakemake logs dir to tmp dir after run finished
        # this is so it's easily findable if there is a problem while running
    # implement nucleotide mode :(

conda create -n gtotree-dev -c astrobiomike -c conda-forge -c bioconda gtotree

conda activate gtotree-dev
conda install tqdm=4.67.1
conda install pyhmmer=0.11.0
conda install snakemake=8.30.0
pip install -e gtotree/

# example test
rm -rf gtotree-output/ ; gtotree2 -a ncbi-accessions.txt -H Universal -j 4

gtotree2 -a ncbi_accessions.txt -g genbank_files.txt -A amino_acid_files.txt -f fasta_files.txt -H Universal -j 4 -t -P

GToTree -a ncbi_accessions.txt -g genbank_files.txt -A amino_acid_files.txt -f fasta_files.txt -H Universal -j 4 -t -P -F

gtotree2 -a ncbi_accessions.txt -g GToTree-test-data/genbank_files.txt -f GToTree-test-data/fasta_files.txt -A GToTree-test-data/amino_acid_files.txt -j 4 -t -P

### OVERALL NOTES ###
# add a stop at "Summary of input-genome preprocessing" to check there are more than 3 as needed to make a tree
# need a lot of testing on resume functionality
    # if i count on the resume flag for operating, i may need to make sure it makes sense up front (like does the run-data.json exist)
# need some check and handling if the input files changed when doing a resume
    # maybe just check and require they haven't changed at all, or a new run is needed
# when a resume is done, may want to just try snakemake workflows on inputs that failed the prior runs
# might not be using gnu parallel anymore due to snakemake files, so check that at the end
    # oh, add snakemake to definite citations
# since multiple logs may be created with --resume function, might need to add functionality to back up a log that exists to a sub-dir,
    # maybe with a time/date stamp of when first run appended to the name
# eventually look into putting a block for this prodigal failure: "at least 100000 bases for training." (search original files)
    # maybe just make a check that input genomes are greater than 100,000 bases (if that consistently triggers it)
# eventually add a check that nucleotide fasta inputs are nucleotide and not amino acid, and vice versa
# eventually do something with gunzipped files we generated (probably delete them, leaving the originals)

### TO DO ###

# switch to only using http when available
    # affects:
        # get_ncbi_assembly_tables.py (DONE)
        # ncbi assembly downloads (DONE)
        # kofamscan data is only available via ftp (maybe host this somewhere else for GToTree)



### CHANGES ###

# default output changed to "gtotree-output"
# default lineage settings are D,P,C,S (no longer strain)
# http is used instead of ftp always where available (used to be ftp by default with http option)
# several output files and dirs had underscores changed to dashes (sorry, i now hate underscores when they're not necessary)
# estimated percent completion and redundancy are no long provided
    # (this was always just "free" info, but checkm2 is a much better way to do this, so i made the decision to stop providing it at all)
# --resume flag added (will be set automatically if the same output dir but no `-F` flag provided)
# taxids are no longer searched for in input genbank files, they will only be found/used for provided input ncbi-accessions
    # if this is actually a feature that benefitted anyone, i'll add it back in upon request :)
# the order of processing changed slightly from v1 to v2, so the output report messages vary a little
    # in v1, each genome was downloaded/parsed and scanned for the target genes in one pass
    # in v2, all input genomes are prepared for each input source, then all are searched together

### PLACES TO DEF IMPROVE ###


### IMPROVEMENTS to highlight in paper ###

# python packaging and structure (rather than 4,000 lines of bash as main runner with dozens of individual python helper scripts)
# instead of just exiting and informing when input files have problems, GToTree2 fixes them
    # e.g., duplicate entries will be unique'd, windows line-endings will be converted, changes written to a new file that is then used
# snakemake control over the main components for easier restart capabilities
# things i've added over time
    # gtt-gen-SCG-HMMs
    # gtt-get-GTDB-accessions
    # gtt-subset...
    # new prepackaged HMMs based on GTDB taxonomy
    # in tandem scanning of target KOs or pfams, files for added vizualization in iToL

### """
# In its first 6 years, the original GToTree received over 500 citations and had tens of thousands of Conda installs. It has been
# successfully used and maintained over this time, despite its foundation being a main runner of ~4,000 lines of BASH and dozens of independent python
# and BASH helper scripts with a lot of redundancy in its code base. This was purely a consequence of my capabilities at the time.
### """
